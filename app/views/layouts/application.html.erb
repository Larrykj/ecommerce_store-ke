<!DOCTYPE html>

<html>

  <head>

    <title><%= t('app_name') %></title>

    <meta name="viewport" content="width=device-width,initial-scale=1">

    <%= csrf_meta_tags %>

    <%= csp_meta_tag %>



    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

    <%= javascript_importmap_tags %>

    

    <!-- Bootstrap CSS -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>

    

    <style>

      body {

        background-color: #f8f9fa;

        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

        min-height: 100vh;

        display: flex;

        flex-direction: column;

      }

      .navbar {

        box-shadow: 0 2px 4px rgba(0,0,0,.1);

      }

      footer {

        margin-top: auto;

      }

    </style>

  </head>



  <body>

    <!-- Navigation Bar -->

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">

  <div class="container">

    <%= link_to t("app_name"), root_path, class: "navbar-brand" %>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">

      <span class="navbar-toggler-icon"></span>

    </button>

    <div class="collapse navbar-collapse" id="navbarNav">

      <ul class="navbar-nav ms-auto">

        <li class="nav-item">

          <%= link_to t("products"), products_path, class: "nav-link" %>

        </li>

        <li class="nav-item">

          <%= link_to t("categories"), categories_path, class: "nav-link" %>

        </li>

        

        <!-- Language Switcher -->

        <li class="nav-item dropdown">

          <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown">

            <i class="bi bi-globe"></i> <%= I18n.locale.to_s.upcase %>

          </a>

          <ul class="dropdown-menu">

            <li><%= link_to "English", url_for(request.params.merge(locale: "en")), class: "dropdown-item #{'active' if I18n.locale.to_s == 'en'}" %></li>

            <li><%= link_to "EspaÃ±ol", url_for(request.params.merge(locale: "es")), class: "dropdown-item #{'active' if I18n.locale == :es}" %></li>

            <li><%= link_to "Kiswahili", url_for(request.params.merge(locale: "sw")), class: "dropdown-item #{'active' if I18n.locale == :sw}" %></li>

            <li><%= link_to "FranÃ§ais", url_for(request.params.merge(locale: "fr")), class: "dropdown-item #{'active' if I18n.locale == :fr}" %></li>

            <li><%= link_to "Deutsch", url_for(request.params.merge(locale: "de")), class: "dropdown-item #{'active' if I18n.locale == :de}" %></li>

            <li><%= link_to "ä¸­æ–‡ (Chinese)", url_for(request.params.merge(locale: "zh")), class: "dropdown-item #{'active' if I18n.locale == :zh}" %></li>

            <li><%= link_to "æ—¥æœ¬èªž (Japanese)", url_for(request.params.merge(locale: "ja")), class: "dropdown-item #{'active' if I18n.locale == :ja}" %></li>

            <li><%= link_to "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic)", url_for(request.params.merge(locale: "ar")), class: "dropdown-item #{'active' if I18n.locale == :ar}" %></li>

            <li><%= link_to "PortuguÃªs", url_for(request.params.merge(locale: "pt")), class: "dropdown-item #{'active' if I18n.locale == :pt}" %></li>

            <li><%= link_to "Ð ÑƒÑÑÐºÐ¸Ð¹", url_for(request.params.merge(locale: "ru")), class: "dropdown-item #{'active' if I18n.locale == :ru}" %></li>

          </ul>

        </li>



        <!-- Currency Switcher -->

        <li class="nav-item dropdown">

          <a class="nav-link dropdown-toggle" href="#" id="currencyDropdown" role="button" data-bs-toggle="dropdown">

            <%= current_currency %>

          </a>

          <ul class="dropdown-menu">

             <li><%= link_to "KES", url_for(request.params.merge(currency: "KES")), class: "dropdown-item #{'active' if current_currency == 'KES'}" %></li>

             <li><%= link_to "USD", url_for(request.params.merge(currency: "USD")), class: "dropdown-item #{'active' if current_currency == 'USD'}" %></li>

             <li><%= link_to "EUR", url_for(request.params.merge(currency: "EUR")), class: "dropdown-item #{'active' if current_currency == 'EUR'}" %></li>

             <li><%= link_to "GBP", url_for(request.params.merge(currency: "GBP")), class: "dropdown-item #{'active' if current_currency == 'GBP'}" %></li>

             <li><%= link_to "JPY", url_for(request.params.merge(currency: "JPY")), class: "dropdown-item #{'active' if current_currency == 'JPY'}" %></li>

             <li><%= link_to "CNY", url_for(request.params.merge(currency: "CNY")), class: "dropdown-item #{'active' if current_currency == 'CNY'}" %></li>

             <li><%= link_to "INR", url_for(request.params.merge(currency: "INR")), class: "dropdown-item #{'active' if current_currency == 'INR'}" %></li>

             <li><%= link_to "CAD", url_for(request.params.merge(currency: "CAD")), class: "dropdown-item #{'active' if current_currency == 'CAD'}" %></li>

             <li><%= link_to "AUD", url_for(request.params.merge(currency: "AUD")), class: "dropdown-item #{'active' if current_currency == 'AUD'}" %></li>

             <li><%= link_to "ZAR", url_for(request.params.merge(currency: "ZAR")), class: "dropdown-item #{'active' if current_currency == 'ZAR'}" %></li>

          </ul>

        </li>



        <% if user_signed_in? %>

          <li class="nav-item">

            <%= link_to t("add_product"), new_product_path, class: "nav-link" %>

          </li>

          <li class="nav-item">

            <%= link_to cart_path, class: "nav-link position-relative" do %>

              ðŸ›’ <%= t("cart") %>

              <% if @cart && @cart.total_items > 0 %>

                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">

                  <%= @cart.total_items %>

                </span>

              <% end %>

            <% end %>

          </li>

          <li class="nav-item dropdown">

            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">

              <%= current_user.name || current_user.email %>

            </a>

            <ul class="dropdown-menu">

              <li><%= link_to t("my_orders"), orders_path, class: "dropdown-item" %></li>

              <li><%= link_to t("edit_profile"), edit_user_registration_path, class: "dropdown-item" %></li>

              <li><hr class="dropdown-divider"></li>

              <li><%= button_to t("logout"), destroy_user_session_path, method: :delete, class: "dropdown-item" %></li>

            </ul>

          </li>

        <% else %>

          <li class="nav-item">

            <%= link_to t("login"), new_user_session_path, class: "nav-link" %>

          </li>

          <li class="nav-item">

            <%= link_to t("signup"), new_user_registration_path, class: "nav-link" %>

          </li>

          <li class="nav-item">

            <%= link_to cart_path, class: "nav-link position-relative" do %>

              ðŸ›’ <%= t("cart") %>

              <% if @cart && @cart.total_items > 0 %>

                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">

                  <%= @cart.total_items %>

                </span>

              <% end %>

            <% end %>

          </li>

        <% end %>

      </ul>

    </div>

  </div>

</nav>



    <div class="container mb-5">

      <% if notice %>

        <div class="alert alert-success alert-dismissible fade show" role="alert">

          <%= notice %>

          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

        </div>

      <% end %>

      

      <% if alert %>

        <div class="alert alert-danger alert-dismissible fade show" role="alert">

          <%= alert %>

          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

        </div>

      <% end %>

      

      <%= yield %>

    </div>



    <footer class="bg-dark text-white text-center py-3 mt-auto">

      <div class="container">

        <p class="mb-0">&copy; <%= Time.current.year %> <%= t('app_name') %>. <%= t('footer_rights') %></p>

      </div>

    </footer>



    <!-- Bootstrap JS Bundle with Popper -->
    
    <script>
      // Password visibility toggle - Compatible with Turbo
      function setupPasswordToggles() {
        function setupPasswordToggle(passwordId, buttonId, iconId) {
          const button = document.getElementById(buttonId);
          if (button) {
            // Remove old listener if exists
            button.replaceWith(button.cloneNode(true));
            const newButton = document.getElementById(buttonId);
            
            newButton.addEventListener('click', function(e) {
              e.preventDefault();
              const passwordField = document.getElementById(passwordId);
              const eyeIcon = document.getElementById(iconId);
              
              if (passwordField && eyeIcon) {
                if (passwordField.type === 'password') {
                  passwordField.type = 'text';
                  eyeIcon.classList.remove('bi-eye');
                  eyeIcon.classList.add('bi-eye-slash');
                } else {
                  passwordField.type = 'password';
                  eyeIcon.classList.remove('bi-eye-slash');
                  eyeIcon.classList.add('bi-eye');
                }
              }
            });
          }
        }
        
        // Setup all password toggles
        setupPasswordToggle('login-password', 'toggle-login-password', 'login-eye-icon');
        setupPasswordToggle('signup-password', 'toggle-signup-password', 'signup-eye-icon');
        setupPasswordToggle('signup-password-confirm', 'toggle-signup-password-confirm', 'signup-confirm-eye-icon');
        setupPasswordToggle('reset-password', 'toggle-reset-password', 'reset-eye-icon');
        setupPasswordToggle('reset-password-confirm', 'toggle-reset-password-confirm', 'reset-confirm-eye-icon');
      }
      
      // Run on initial load and every Turbo navigation
      document.addEventListener('DOMContentLoaded', setupPasswordToggles);
      document.addEventListener('turbo:load', setupPasswordToggles);
      document.addEventListener('turbo:render', setupPasswordToggles);
    </script>

  </body>
</html>