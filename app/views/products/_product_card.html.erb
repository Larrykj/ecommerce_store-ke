<div class="product-card h-100">
  <div class="product-image-wrap">
    <% if product.image.attached? %>
      <%= image_tag product.image, class: "product-image", alt: product.name %>
    <% else %>
      <div class="product-placeholder">
        <i class="bi bi-box-seam"></i>
      </div>
    <% end %>
    <span class="stock-badge badge-<%= product.stock_status_class %>">
      <%= product.stock_status_label %>
    </span>
    <div class="product-overlay">
      <%= link_to product_path(product), class: "overlay-btn", title: "View" do %>
        <i class="bi bi-eye"></i>
      <% end %>
      
      <% if current_user && defined?(@wishlist_map) %>
        <% if wishlist_item = @wishlist_map[product.id] %>
            <%= button_to wishlist_item_path(wishlist_item), method: :delete, class: "overlay-btn", style: "color: #ef4444;", title: "Remove from Wishlist" do %>
                <i class="bi bi-heart-fill"></i>
            <% end %>
        <% else %>
            <%= button_to wishlist_items_path(product_id: product.id), method: :post, class: "overlay-btn", title: "Add to Wishlist" do %>
                <i class="bi bi-heart"></i>
            <% end %>
        <% end %>
      <% end %>

      <%= link_to edit_product_path(product), class: "overlay-btn", title: "Edit" do %>
        <i class="bi bi-pencil"></i>
      <% end %>
    </div>
  </div>
  <div class="product-info">
    <% if product.category %>
      <span class="product-category"><%= product.category.name %></span>
    <% end %>
    <h3 class="product-name"><%= link_to product.name, product_path(product) %></h3>
    <p class="product-desc"><%= truncate(product.description, length: 80) %></p>
    <div class="product-footer">
      <div class="product-price">
        <span class="currency">KSh</span>
        <span class="amount"><%= number_with_delimiter(product.price.to_i) %></span>
      </div>
      <% if product.in_stock? %>
        <%= button_to cart_items_path(product_id: product.id), method: :post, class: "add-cart-btn", title: "Add to Cart" do %>
          <i class="bi bi-cart-plus"></i>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
